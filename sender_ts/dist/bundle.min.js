var CastSender=function(e){"use strict";class t{debug(...e){console.debug(...e)}error(...e){console.error(...e)}info(...e){console.info(...e)}warn(...e){console.warn(...e)}}class i{constructor(e){this.name=e}static init(){i.logger=new t}debug(...e){console.log(this.name,...e),i.logger.debug(this.name,...e)}error(...e){i.logger.error(this.name,...e)}info(...e){i.logger.info(this.name,...e)}warn(...e){i.logger.warn(this.name,...e)}}class r{constructor(e,t,i){this.remotePlayer=e,this.remotePlayerController=t,this.currentMediaTime=0,this.mediaInfo=null,this.isLiveContent=!1,this.context=i}play(){this.remotePlayer.isPaused&&this.remotePlayerController.playOrPause()}pause(){this.remotePlayer.isPaused||this.remotePlayerController.playOrPause()}stop(){this.remotePlayerController.stop()}load(e,t){var i;console.log("Loading...",e,t);let r=new chrome.cast.media.MediaInfo(e,"");t&&(r.customData={drm:t}),r.metadata=new chrome.cast.media.GenericMediaMetadata,r.metadata.title="TODO TITLE",r.metadata.subtitle="TODO SUBTITLE";let a=new chrome.cast.media.LoadRequest(r);a.currentTime=this.currentMediaTime,a.autoplay=!0,null===(i=this.context.getCurrentSession())||void 0===i||i.loadMedia(a).then((()=>{console.log("Remote media loaded")}),(e=>{console.log("Remote media load error: "+function(e){switch(e.code){case chrome.cast.ErrorCode.API_NOT_INITIALIZED:return"The API is not initialized."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.CANCEL:return"The operation was canceled by the user"+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.CHANNEL_ERROR:return"A channel to the receiver is not available."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.EXTENSION_MISSING:return"The Cast extension is not available."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.INVALID_PARAMETER:return"The parameters to the operation were not valid."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.RECEIVER_UNAVAILABLE:return"No receiver was compatible with the session request."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.SESSION_ERROR:return"A session could not be created, or a session was invalid."+(e.description?" :"+e.description:"");case chrome.cast.ErrorCode.TIMEOUT:return"The operation timed out."+(e.description?" :"+e.description:"");default:return e}}(e))}))}isMediaLoaded(e){let t=this.context.getCurrentSession();return!!t&&!!t.getMediaSession()}getCurrentMediaTime(){var e;return this.isLiveContent&&(null===(e=this.mediaInfo)||void 0===e?void 0:e.metadata)&&this.mediaInfo.metadata.sectionStartTimeInMedia?this.remotePlayer.currentTime-this.mediaInfo.metadata.sectionStartTimeInMedia:this.remotePlayer.currentTime}getMediaDuration(){var e;return this.isLiveContent?null==(null===(e=this.mediaInfo)||void 0===e?void 0:e.metadata)||null==this.mediaInfo.metadata.sectionDuration||null==this.mediaInfo.metadata.sectionStartTimeInMedia?null:this.mediaInfo.metadata.sectionDuration:this.remotePlayer.duration}updateDisplay(){var e;let t=this.context.getCurrentSession();if(t&&t.getMediaSession()&&(null===(e=t.getMediaSession())||void 0===e?void 0:e.media)){let e=t.getMediaSession(),i=null==e?void 0:e.media;(null==i?void 0:i.metadata)&&i.metadata.images&&i.metadata.images.length>0&&i.metadata.images[0].url;let r="",a="";t.getCastDevice().friendlyName,(null==i?void 0:i.metadata)&&(r=i.metadata.title,a=i.metadata.episodeTitle,r=a?r+": "+a:r,r=r?r+" ":"",i.metadata.subtitle)}}updateCurrentTimeDisplay(){var e;this.setTimeString(null!==(e=this.getCurrentMediaTime())&&void 0!==e?e:0)}updateDurationDisplay(){var e;this.setTimeString(null!==(e=this.getMediaDuration())&&void 0!==e?e:0)}setTimeString(e){!function(e){if(null==e||null==e)return null;let t=!1;e<0&&(t=!0,e*=-1);let i=Math.floor(e/3600),r=Math.floor((e-3600*i)/60),a=Math.floor(e-3600*i-60*r),o=i.toString(),s=r.toString(),n=a.toString();i<10&&(o="0"+i),r<10&&(s="0"+r),a<10&&(n="0"+a)}(e)}setVolume(e){this.remotePlayer.volumeLevel=e,this.remotePlayerController.setVolumeLevel()}mute(){this.remotePlayer.isMuted||this.remotePlayerController.muteOrUnmute()}unMute(){this.remotePlayer.isMuted&&this.remotePlayerController.muteOrUnmute()}isMuted(){return this.remotePlayer.isMuted}seekTo(e){this.remotePlayer.currentTime=e,this.remotePlayerController.seek()}}class a{constructor(){this.remotePlayer=null,this.remotePlayerController=null,this.currentMediaTime=0,this.mediaDuration=-1,this.timer=null,this.incrementMediaTimeHandler=this.incrementMediaTime.bind(this),this.seekMediaListener=this.seekMedia.bind(this),this.currentMediaUrl="",this.mediaInfo=null,this.liveSeekableRange=null,this.isLiveContent=!1,this.logger=new i("CastPlayer")}viewElement(){this.logger.debug("[Player viewElement]");const e=document.createElement("google-cast-launcher");return e.id="cast_button",e}initializeCastPlayer(){this.logger.debug("initializeCastPlayer"),this.context=cast.framework.CastContext.getInstance();const e={receiverApplicationId:"CE104983",autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED};this.context.setOptions(e),this.remotePlayer=new cast.framework.RemotePlayer,this.remotePlayerController=new cast.framework.RemotePlayerController(this.remotePlayer),this.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_CONNECTED_CHANGED,(e=>{var t;this.logger.debug("RemotePlayerController.IS_CONNECTED_CHANGED"),this.stopProgressTimer(),cast&&cast.framework&&(null===(t=this.remotePlayer)||void 0===t?void 0:t.isConnected)&&this.setupRemotePlayer()})),this.player=new r(this.remotePlayer,this.remotePlayerController,this.context)}prepareToPlay(){this.mediaDuration=this.player.getMediaDuration(),this.player.updateDurationDisplay(),this.player.play(),this.startProgressTimer(),this.player.updateDisplay()}setupRemotePlayer(){var e,t,i,r,a,o,s,n;this.logger.debug("setupRemotePlayer"),null===(e=this.remotePlayerController)||void 0===e||e.addEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,(e=>{this.logger.debug("RemotePlayer.MEDIA_INFO_CHANGED",e);let t=this.context.getCurrentSession();if(!t)return this.mediaInfo=null,this.isLiveContent=!1,void this.player.updateDisplay();let i=t.getMediaSession();if(!i)return this.mediaInfo=null,this.isLiveContent=!1,void this.player.updateDisplay();this.mediaInfo=i.media,this.mediaInfo?this.isLiveContent=this.mediaInfo.streamType==chrome.cast.media.StreamType.LIVE:this.isLiveContent=!1,this.prepareToPlay(),this.player.updateDisplay()})),null===(t=this.remotePlayerController)||void 0===t||t.addEventListener(cast.framework.RemotePlayerEventType.CAN_SEEK_CHANGED,(e=>{this.logger.debug("RemotePlayer.CAN_SEEK_CHANGED",e)})),null===(i=this.remotePlayerController)||void 0===i||i.addEventListener(cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED,(()=>{var e,t;this.logger.debug("RemotePlayer.IS_PAUSED_CHANGED",null===(e=this.remotePlayer)||void 0===e?void 0:e.isPaused),(null===(t=this.remotePlayer)||void 0===t?void 0:t.isPaused)?this.player.pause():this.player.play()})),null===(r=this.remotePlayerController)||void 0===r||r.addEventListener(cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,(()=>{var e,t;this.logger.debug("RemotePlayer.IS_MUTED_CHANGED",null===(e=this.remotePlayer)||void 0===e?void 0:e.isMuted),(null===(t=this.remotePlayer)||void 0===t?void 0:t.isMuted)?this.player.mute():this.player.unMute()})),null===(a=this.remotePlayerController)||void 0===a||a.addEventListener(cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,(()=>{var e;this.logger.debug("RemotePlayer.VOLUME_LEVEL_CHANGED",null===(e=this.remotePlayer)||void 0===e?void 0:e.volumeLevel)})),null===(o=this.remotePlayerController)||void 0===o||o.addEventListener(cast.framework.RemotePlayerEventType.LIVE_SEEKABLE_RANGE_CHANGED,(e=>{console.log("LIVE_SEEKABLE_RANGE_CHANGED"),this.liveSeekableRange=e.value})),(null===(s=this.remotePlayer)||void 0===s?void 0:s.isMuted)&&this.player.mute(),(null===(n=this.context.getCurrentSession())||void 0===n?void 0:n.getSessionState())==cast.framework.SessionState.SESSION_RESUMED&&(console.log("Resuming session"),this.prepareToPlay())}selectMedias(e){console.log("Media index selected: "+e),this.currentMediaUrl=e,this.stopProgressTimer(),this.currentMediaTime=0,this.player.setTimeString(0),this.player.setTimeString(0),this.player.play()}seekMedia(e){var t,i;null==this.mediaDuration||this.context.getCurrentSession()&&!(null===(t=this.remotePlayer)||void 0===t?void 0:t.canSeek)?console.log("Error - Not seekable"):!this.isLiveContent||this.liveSeekableRange?(this.currentMediaTime=e,this.isLiveContent&&(e+=null===(i=this.mediaInfo)||void 0===i?void 0:i.metadata.sectionStartTimeInMedia),this.player.seekTo(e)):console.log("Live content has no seekable range.")}setVolume(e){this.player.setVolume(e)}startProgressTimer(){this.stopProgressTimer(),this.timer=setInterval(this.incrementMediaTimeHandler,1e3)}stopProgressTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)}incrementMediaTime(){this.currentMediaTime=this.player.getCurrentMediaTime(),this.mediaDuration=this.player.getMediaDuration(),this.player.updateDurationDisplay(),null==this.mediaDuration||this.currentMediaTime<this.mediaDuration||this.isLiveContent?(this.player.updateCurrentTimeDisplay(),this.updateProgressBarByTimer()):this.mediaDuration>0&&this.endPlayback()}updateProgressBarByTimer(){var e,t,i,r;if(null!=this.mediaDuration){this.isLiveContent&&this.liveSeekableRange&&(Math.max(null===(e=this.mediaInfo)||void 0===e?void 0:e.metadata.sectionStartTimeInMedia,this.liveSeekableRange.end),null===(t=this.mediaInfo)||void 0===t||t.metadata.sectionStartTimeInMedia,Math.max(null===(i=this.mediaInfo)||void 0===i?void 0:i.metadata.sectionStartTimeInMedia,this.liveSeekableRange.start),null===(r=this.mediaInfo)||void 0===r||r.metadata.sectionStartTimeInMedia);var a=Math.floor(this.currentMediaTime/this.mediaDuration);a>1?a=1:a<0&&(a=0),a>=1&&!this.isLiveContent&&this.endPlayback()}else this.isLiveContent||console.log("Error - Duration is not defined for a VOD stream.")}endPlayback(){this.currentMediaTime=0,this.stopProgressTimer(),this.player.updateDisplay()}}i.init();let o=new a;return window.__onGCastApiAvailable=function(e){e&&o.initializeCastPlayer()},e.CastPlayer=a,e.castPlayer=o,e}({});
//# sourceMappingURL=bundle.min.js.map
